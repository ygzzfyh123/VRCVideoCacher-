name: Build VRCVideoCacher

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    name: Build on Windows
    runs-on: windows-latest

    env:
      Solution_Name: VRCVideoCacher.sln
      Configuration: Release

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v2

    - name: Restore NuGet Packages
      run: nuget restore ${{ env.Solution_Name }}

    - name: Build Full Package (编译完整版)
      run: msbuild ${{ env.Solution_Name }} /p:Configuration=${{ env.Configuration }} /p:Platform="Any CPU"


    - name: Publish Single File (编译单文件)
      run: |
        dotnet publish ${{ env.Solution_Name }} -c Release -r win-x64 --self-contained false -p:PublishSingleFile=true -p:EnableCompressionInSingleFile=true -o ./SingleFileOutput


    - name: Upload Full Package (上传完整包)
      uses: actions/upload-artifact@v4
      with:
     
        name: Full-Package-Run-${{ github.run_number }}
     
        path: '**/bin/Release/*'


    - name: Upload Single EXE (上传独立EXE)
      uses: actions/upload-artifact@v4
      with:
        name: Single-Exe-Run-${{ github.run_number }}
    
        path: ./SingleFileOutput
