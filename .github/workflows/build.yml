name: Build VRCVideoCacher

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    name: Build on Windows
    runs-on: windows-latest

    env:
      Solution_Name: VRCVideoCacher.sln
      Configuration: Release

    steps:
    - name: Checkout Code (拉取代码)
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup MSBuild (安装构建工具)
      uses: microsoft/setup-msbuild@v2

    - name: Setup NuGet (安装包管理器)
      uses: NuGet/setup-nuget@v2

    - name: Restore NuGet Packages (下载依赖库)
      run: nuget restore ${{ env.Solution_Name }}

    - name: Build Solution (编译程序)
      run: msbuild ${{ env.Solution_Name }} /p:Configuration=${{ env.Configuration }} /p:Platform="Any CPU"



    - name: Compress Build (制作压缩包)
      run: |
        # 使用 PowerShell 强制打包 Release 目录下的所有文件
        # -Force 确保如果有同名文件会覆盖
        powershell Compress-Archive -Path "**/bin/Release/*" -DestinationPath VRCVideoCacher-Release.zip -Force

    - name: Upload Build Artifact (上传并重命名)
      uses: actions/upload-artifact@v4
      with:

        name: 自动构建触发，这是第${{ github.run_number }}次任务
        

        path: VRCVideoCacher-Release.zip
